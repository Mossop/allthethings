interface Item {
  id: ID!
  icon: String
  summary: String!
}

type Task implements Item {
  # Item
  id: ID!
  icon: String
  summary: String!

  done: Boolean!
  link: String
}

type File implements Item {
  # Item
  id: ID!
  icon: String
  summary: String!
}

type Note implements Item {
  # Item
  id: ID!
  icon: String
  summary: String!

  note: String!
}

type Link implements Item {
  # Item
  id: ID!
  icon: String
  summary: String!

  link: String!
}

interface TaskList {
  subprojects: [Project!]!
  sections: [Section!]!
  items: [Item!]!
}

interface ProjectRoot implements TaskList {
  # TaskList
  subprojects: [Project!]!
  sections: [Section!]!
  items: [Item!]!

  projects: [Project!]!
  projectById(id: ID!): Project
}

type User implements ProjectRoot & TaskList @entity {
  # TaskList
  subprojects: [Project!]!
  sections: [Section!]!
  items: [Item!]!

  # ProjectRoot
  projects: [Project!]!
  projectById(id: ID!): Project

  id: ID! @id
  email: String! @column
  password: String! @column
  contexts: [Context!]!
}

type Context implements ProjectRoot & TaskList @entity {
  # TaskList
  subprojects: [Project!]!
  sections: [Section!]!
  items: [Item!]!

  # ProjectRoot
  projects: [Project!]!
  projectById(id: ID!): Project

  id: ID! @id
  user: User! @link
  stub: String!
  name: String! @column
}

type Project implements TaskList @entity(additionalFields: [
  { path: "user", type: "UserDbObject['id']" },
  { path: "context", type: "ContextDbObject['id'] | null" },
  { path: "parent", type: "ProjectDbObject['id'] | null" },
]) {
  # TaskList
  subprojects: [Project!]!
  sections: [Section!]!
  items: [Item!]!

  id: ID! @id
  stub: String!
  name: String! @column
  taskList: TaskList!
}

type Section @entity(additionalFields: [
  { path: "user", type: "UserDbObject['id']" },
  { path: "context", type: "ContextDbObject['id'] | null" },
  { path: "project", type: "ProjectDbObject['id'] | null" },
  { path: "index", type: "number" },
]) {
  items: [Item!]!

  id: ID! @id
  name: String! @column
}

type Query {
  user: User

  taskList(id: ID!): TaskList
  root(id: ID!): ProjectRoot
}

input CreateContextParams {
  name: String!
}

input CreateProjectParams {
  name: String!
}

input EditProjectParams {
  name: String
}

input CreateSectionParams {
  name: String!
}

input EditSectionParams {
  name: String
}

type Mutation {
  login(email: String!, password: String!): User
  logout: Boolean

  createContext(params: CreateContextParams!): Context!
  deleteContext(id: ID!): Boolean!

  createProject(taskList: ID, params: CreateProjectParams!): Project!
  moveProject(id: ID!, taskList: ID): Project
  editProject(id: ID!, params: EditProjectParams!): Project
  deleteProject(id: ID!): Boolean!

  createSection(taskList: ID, index: Int, params: CreateSectionParams!): Section!
  moveSection(id: ID!, taskList: ID, index: Int): Section
  editSection(id: ID!, params: EditSectionParams!): Section
  deleteSection(id: ID!): Boolean!
}
